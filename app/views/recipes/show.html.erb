<div class="col-11 mx-auto mt-3" data-controller="servings" data-servings-default-servings="<%= @recipe.servings %>">



  <%# image %>
  <div class="col-lg d-flex justify-content-center">
    <%= cl_image_tag @recipe.photo.key, height: 300, width: 300, class: "recipe-show-img rounded-10 shadow", crop: :fill %>
  </div>


  <%# informations %>
  <div class="rounded-10 shadow-sm bg-info p-3 my-3">
    <%# nom de la recette %>
    <h1><%= @recipe.name %></h1>

    <%# pays et XP %>
    <div class="d-flex justify-content-between">
      <%# drapeau et nom du pays %>
      <h4><span class="fi <%= @recipe.country.flag %>"></span> <%= @recipe.country.name.capitalize %></h4>

      <%# xp et checkmark si recette deja réalisée %>
      <% if UserRecipe.where(recipe_id: @recipe.id, user_id: current_user.id).exists? %>
        <div class="d-flex">
          <h4 style="color: rgba(0,0,0,0.4)"><s><%= @recipe.xp %>XP</s></h4>
          <div class="check-circle">✓</div>
        </div>
      <% else %>
        <h4><%= @recipe.xp %>XP</h4>
      <% end %>
    </div>

    <%# difficulté %>
    <div class="d-flex">
      <% difficulty = @recipe.difficulty %>
      <% if difficulty == "hard" %>
        <%= image_tag("hard.png", size: "28") %>
      <% elsif difficulty == "medium" %>
        <%= image_tag("mid.png", size: "28") %>
      <% else %>
        <%= image_tag("ezz.png", size: "28") %>
      <% end %>
      <h4 class="ms-2"><%= @recipe.difficulty.capitalize %></h4>
    </div>

    <%# preptime %>
    <h4><i class="fa-regular fa-clock"></i> <%= @recipe.min_to_h %></h4>

    <%# keywords %>
    <% @recipe.keyword_list.each do |keyword| %>
      <h4 class="keyword <%= "kw-" + keyword %>"><%= keyword.capitalize %></h4>
    <% end %>
  </div>


  <%# Choisir le nombre de personnes grace au controller stimulus servings %>
  <div class="d-inline-block shadow-sm">
    <div class="d-flex">
      <%# bouton - %>
      <div class="py-1 px-3 bg-info servings-minus" data-action="click->servings#minus">-</div>
      <%# "Serves" et l'input de servings %>
      <div class="p-2 bg-info servings-field-div">
        <span class="servings-serves">Serves</span>
        <input type="number" class="servings-field" min="1" max="30" value="<%= @recipe.servings %>" data-servings-target="servingsNumber" data-action="input->servings#updateQuantities">
      </div>
      <%# bouton + %>
      <div class="py-1 px-3 bg-info servings-plus" data-action="click->servings#plus">+</div>
    </div>
  </div>


  <%# ingredients %>
  <div class="rounded-10 shadow-sm bg-info p-3 my-3">
    <h2 class="mb-3">Ingredients:</h2>
    <% @recipe_ingredients.each do |ri| %>
      <p>
        <%# Ajuste la quantité de l'ingrédient en fonction du nombre de servings %>
        <span data-default-quantity="<%= ri.quantity %>" data-servings-target="ingredientQuantity"></span>
        <%= ri.unit %> <%= ri.ingredient.name %>
      </p>
    <% end %>
  </div>


  <%# steps %>
  <div class="rounded-10 shadow-sm bg-info p-3 my-3">
    <h2 class="mb-3">Method:</h2>
    <% @steps.each do |step| %>
      <div>
        <h4>Step <%= step.order_number %>:</h4>
        <p><%= step.instruction %></p>
      </div>
    <% end %>
  </div>


  <%# bouton validation %>
  <div class="text-center mt-4">
    <% if UserRecipe.where(recipe_id: @recipe.id, user_id: current_user.id).exists? %>
      <div class="bouton-invalid">You already cooked this recipe</div>
    <% else %>
      <%= simple_form_for [@recipe, @user_recipe] do |f| %>
        <%= f.input :photo, as: :file, label: "Upload a picture to validate the recipe" %>
        <%= f.button :submit, 'Validate recipe', class: 'bouton-validate' %>
      <% end %>
    <% end %>
  </div>

  <div style="height:20px"></div>
</div>
